<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">

<dom-module id="vote-controls">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <!-- <paper-input section="sec_02" candidate="villano" action="add" id="voteValue" on-keydown="voteInput"></paper-input>  on-blur="_hideInput"-->
    <template is="dom-repeat" items="{{votes}}">
        <template is="dom-if" if="{{isSection(item.__firebaseKey__)}}">
            <p>{{item.__firebaseKey__}} {{filtz(user)}}</p>
            <paper-input id="voteValue" section$="{{item.__firebaseKey__}}" candidate="villano" action="add" on-keydown="voteInput"></paper-input>
        </template>
    </template>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
        is: 'vote-controls',

        filtz: function(item){
            //item = 'caaaazz';
            if(item == false) {
               return false;
            }

            return true;
        },

        isSection: function(element){
            var sectionPrefix = 'sec_';
            var elementPrefix = element.substring(0,4);

            if (elementPrefix === sectionPrefix) {
                return true;
            }

            return false;
        },

        properties: {

            chosenName: {
              type: String,
              value: '',
              notify: true
            },

            blurred: {
              type: Boolean,
              value: false,
              notify: true
            }
        },

        focus: function(){
            this.$.input.focus();
        },

        voteInput: function(e) {
            if (e.keyCode === 13 || e.keyCode === 9) {
                var target = e.target.domHost;
                console.log(target.getAttribute('section'));
                console.log(target.getAttribute('candidate'));
                console.log(target.value);

                //Fires the 'change-vote-input' event; It will be listened as 'change-vote-input'
                this.fire('change-vote-input', {
                    section: target.getAttribute('section'),
                    candidate: target.getAttribute('section'),
                    value: target.value
                });
            }
        }

        /*
        _hideInput: function(e) {
            //if(this.$.userName.value){
                console.log('Animation to show input');
                this.chosenName = this.$.userName.value;
                this.fire('add-name', {value: this.$.userName.value});
                this.$.userName.value = null;
            //}
        }
        */
    });
  })();
  </script>
</dom-module>
